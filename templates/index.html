<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>間違い探し粛清ソリューション</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>
  <body>
    <header>
      <h1>間違い探し粛清ソリューション (MVP)</h1>
      <p>2枚の「間違い探し」の画像をアップロードして、違いを見つけましょう。</p>
    </header>

    <main class="container">
      <div class="upload-container">
        <form id="compareForm" enctype="multipart/form-data">
          <div class="image-upload-wrapper">
            <div class="image-upload-box" id="image-box-1">
              <input
                type="file"
                id="image1"
                name="image1"
                accept="image/*"
                required
              />
              <label for="image1" class="image-upload-label">
                <img
                  src="https://via.placeholder.com/300x200.png?text=画像1を選択"
                  alt="画像1プレビュー"
                  id="preview1"
                />
                <span>画像1をアップロード</span>
              </label>
            </div>
            <div class="image-upload-box" id="image-box-2">
              <input
                type="file"
                id="image2"
                name="image2"
                accept="image/*"
                required
              />
              <label for="image2" class="image-upload-label">
                <img
                  src="https://via.placeholder.com/300x200.png?text=画像2を選択"
                  alt="画像2プレビュー"
                  id="preview2"
                />
                <span>画像2をアップロード</span>
              </label>
            </div>
          </div>
          <button type="submit" class="submit-btn">比較実行</button>
        </form>
      </div>

      <div class="result-container">
        <h2>実行結果</h2>
        <div id="loading" class="loading-indicator" style="display: none">
          <div class="spinner"></div>
          <p>処理中です...</p>
        </div>
        <div id="result" class="result-area">
          <p>ここに結果画像が表示されます。</p>
        </div>
      </div>
    </main>

    <footer>
      <p>&copy; 2024 間違い探し粛清ソリューション</p>
    </footer>

    <script>
      document
        .getElementById("image1")
        .addEventListener("change", function (event) {
          const preview = document.getElementById("preview1");
          const file = event.target.files[0];
          if (file) {
            preview.src = URL.createObjectURL(file);
          }
        });

      document
        .getElementById("image2")
        .addEventListener("change", function (event) {
          const preview = document.getElementById("preview2");
          const file = event.target.files[0];
          if (file) {
            preview.src = URL.createObjectURL(file);
          }
        });

      document
        .getElementById("compareForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          const form = event.target;
          const formData = new FormData(form);
          const loading = document.getElementById("loading");
          const resultDiv = document.getElementById("result");

          loading.style.display = "flex";
          resultDiv.innerHTML = "<p>ここに結果画像が表示されます。</p>";
          resultDiv.style.display = "none";

          try {
            const response = await fetch("/compare", {
              method: "POST",
              body: formData,
            });

            const data = await response.json();
            resultDiv.style.display = "block";

            if (response.ok) {
              resultDiv.innerHTML = `<img src="${data.result_image}" alt="比較結果">`;
            } else {
              resultDiv.innerHTML = `<p class="error-message">エラー: ${data.error}</p>`;
            }
          } catch (error) {
            resultDiv.style.display = "block";
            resultDiv.innerHTML = `<p class="error-message">通信エラーが発生しました: ${error}</p>`;
          } finally {
            loading.style.display = "none";
          }
        });
    </script>
  </body>
</html>
